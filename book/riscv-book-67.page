<div id="pf43" class="pf w0 h0" data-page-no="43"><div class="pc pc43 w0 h0"><img class="bi xf y10c w2 hf" alt="" src="bg43.png"/><div class="t m0 xf h8 y10d ff3 fs4 fc0 sc0 ls0 ws0">4.7.<span class="_ _1f"> </span>ASSEMBL<span class="_ _9"></span>Y<span class="_ _2"> </span>DIRECTIVES</div><div class="t m0 x114 h9 ya97 ff22 fs11 fc0 sc0 ls0 ws0">1<span class="_ _2a"> </span><span class="ff5 fs4">.text</span></div><div class="t m0 x114 h9 ya98 ff22 fs11 fc0 sc0 ls0 ws0">2<span class="_ _2a"> </span><span class="ff5 fs4">foo:</span></div><div class="t m0 x114 h9 ya99 ff22 fs11 fc0 sc0 ls0 ws0">3<span class="_ _37"> </span><span class="ff5 fs4">j<span class="_ _18"> </span>next</span></div><div class="t m0 x114 h9 ya9a ff22 fs11 fc0 sc0 ls0 ws0">4<span class="_ _37"> </span><span class="ff5 fs4">.byte<span class="_ _18"> </span>0xa</span></div><div class="t m0 x114 h9 ya9b ff22 fs11 fc0 sc0 ls0 ws0">5<span class="_ _2a"> </span><span class="ff5 fs4">next:</span></div><div class="t m0 x114 h9 ya9c ff22 fs11 fc0 sc0 ls0 ws0">6<span class="_ _37"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 xc h8 ya9d ff3 fs4 fc0 sc0 ls0 ws0">Ev<span class="_ _1"></span>en<span class="_ _a"> </span>though<span class="_ _a"> </span>the<span class="_ _a"> </span>previous<span class="_ _a"> </span>program<span class="_ _a"> </span>was<span class="_ _35"> </span>assembled<span class="_ _35"> </span>by<span class="_ _35"> </span>the<span class="_ _a"> </span>assembler,<span class="_ _a"> </span>a<span class="_ _a"> </span>R<span class="_ _12"></span>V32I<span class="_ _a"> </span>CPU<span class="_ _a"> </span>will<span class="_ _a"> </span>fail<span class="_ _a"> </span>when<span class="_ _a"> </span>trying</div><div class="t m0 xf h8 ya9e ff3 fs4 fc0 sc0 ls0 ws0">to<span class="_ _6"> </span>execute<span class="_ _6"> </span>the<span class="_ _6"> </span><span class="ff5">ret<span class="_ _2"> </span></span>instruction<span class="_ _6"> </span>b<span class="_ _5"></span>ecause<span class="_ _6"> </span>it<span class="_ _6"> </span>requires<span class="_ _2"> </span>all<span class="_ _6"> </span>instructions<span class="_ _6"> </span>to<span class="_ _6"> </span>b<span class="_ _5"></span>e<span class="_ _2"> </span>stored<span class="_ _6"> </span>starting<span class="_ _6"> </span>at<span class="_ _6"> </span>addresses<span class="_ _2"> </span>that</div><div class="t m0 xf h8 ya9f ff3 fs4 fc0 sc0 ls0 ws0">are<span class="_ _2"> </span>m<span class="_ _1"></span>ultiple<span class="_ _2"> </span>of<span class="_ _6"> </span>four.</div><div class="t m0 xc h8 yaa0 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _b"> </span>programmer<span class="_ _34"> </span>(or<span class="_ _34"> </span>the<span class="_ _34"> </span>compiler)<span class="_ _34"> </span>is<span class="_ _34"> </span>resp<span class="_ _5"></span>onsible<span class="_ _34"> </span>for<span class="_ _b"> </span>keeping<span class="_ _b"> </span>R<span class="_ _12"></span>V32I<span class="_ _34"> </span>instructions<span class="_ _34"> </span>aligned<span class="_ _34"> </span>to<span class="_ _34"> </span>4-byte</div><div class="t m0 xf h8 yaa1 ff3 fs4 fc0 sc0 ls0 ws0">b<span class="_ _5"></span>oundaries,<span class="_ _b"> </span><span class="ff8">i.e.</span>,<span class="_ _34"> </span>at<span class="_ _34"> </span>addresses<span class="_ _b"> </span>that<span class="_ _b"> </span>are<span class="_ _b"> </span>multiple<span class="_ _b"> </span>of<span class="_ _b"> </span>four.<span class="_ _d"> </span>In<span class="_ _b"> </span>the<span class="_ _b"> </span>previous<span class="_ _b"> </span>example,<span class="_ _34"> </span>it<span class="_ _34"> </span>could<span class="_ _b"> </span>b<span class="_ _5"></span>e<span class="_ _b"> </span>done<span class="_ _b"> </span>by</div><div class="t m0 xf h8 yaa2 ff3 fs4 fc0 sc0 ls0 ws0">adv<span class="_ _27"></span>ancing<span class="_ _6"> </span>the<span class="_ _2"> </span>lo<span class="_ _5"></span>cation<span class="_ _2"> </span>counter by<span class="_ _6"> </span>three<span class="_ _2"> </span>units<span class="_ _2"> </span>righ<span class="_ _1"></span>t<span class="_ _6"> </span>after<span class="_ _2"> </span>adding<span class="_ _2"> </span>the<span class="_ _6"> </span>8-bit<span class="_ _2"> </span>v<span class="_ _27"></span>alue<span class="_ _2"> </span>to<span class="_ _2"> </span>the<span class="_ _6"> </span>program<span class="_ _2"> </span>(line<span class="_ _2"> </span>4).</div><div class="t m0 xf h8 yaa3 ff3 fs4 fc0 sc0 ls0 ws0">In<span class="_ _2"> </span>this<span class="_ _2"> </span>con<span class="_ _1"></span>text,<span class="_ _6"> </span>the<span class="_ _3"> </span>follo<span class="_ _27"></span>wing<span class="_ _2"> </span>co<span class="_ _5"></span>de<span class="_ _2"> </span>would<span class="_ _6"> </span>b<span class="_ _5"></span>e<span class="_ _2"> </span>executed<span class="_ _2"> </span>correctly<span class="_ _2"> </span>by<span class="_ _6"> </span>a<span class="_ _2"> </span>R<span class="_ _12"></span>V32I<span class="_ _2"> </span>CPU.</div><div class="t m0 x114 h9 yaa4 ff22 fs11 fc0 sc0 ls0 ws0">1<span class="_ _2a"> </span><span class="ff5 fs4">.text</span></div><div class="t m0 x114 h9 yaa5 ff22 fs11 fc0 sc0 ls0 ws0">2<span class="_ _2a"> </span><span class="ff5 fs4">foo:</span></div><div class="t m0 x114 h9 yaa6 ff22 fs11 fc0 sc0 ls0 ws0">3<span class="_ _37"> </span><span class="ff5 fs4">j<span class="_ _18"> </span>next</span></div><div class="t m0 x114 h9 yaa7 ff22 fs11 fc0 sc0 ls0 ws0">4<span class="_ _37"> </span><span class="ff5 fs4">.byte<span class="_ _18"> </span>0xa</span></div><div class="t m0 x114 h9 yaa8 ff22 fs11 fc0 sc0 ls0 ws0">5<span class="_ _37"> </span><span class="ff5 fs4">.skip<span class="_ _18"> </span>3<span class="_ _37"> </span>#<span class="_ _18"> </span>Advancing<span class="_ _4"> </span>the<span class="_ _18"> </span>location<span class="_ _4"> </span>counter<span class="_ _4"> </span>by<span class="_ _4"> </span>3<span class="_ _18"> </span>units.</span></div><div class="t m0 x114 h9 yaa9 ff22 fs11 fc0 sc0 ls0 ws0">6<span class="_ _9d"> </span><span class="ff5 fs4">#<span class="_ _18"> </span>This<span class="_ _4"> </span>is<span class="_ _4"> </span>a<span class="_ _4"> </span>very<span class="_ _4"> </span>poor<span class="_ _18"> </span>way<span class="_ _4"> </span>of<span class="_ _4"> </span>keeping<span class="_ _4"> </span>the</span></div><div class="t m0 x114 h9 yaaa ff22 fs11 fc0 sc0 ls0 ws0">7<span class="_ _9d"> </span><span class="ff5 fs4">#<span class="_ _18"> </span>location<span class="_ _4"> </span>counter<span class="_ _4"> </span>aligned<span class="_ _4"> </span>to<span class="_ _4"> </span>a<span class="_ _18"> </span>4<span class="_ _4"> </span>byte<span class="_ _4"> </span>boundary.</span></div><div class="t m0 x114 h9 yaab ff22 fs11 fc0 sc0 ls0 ws0">8<span class="_ _2a"> </span><span class="ff5 fs4">next:</span></div><div class="t m0 x114 h9 yaac ff22 fs11 fc0 sc0 ls0 ws0">9<span class="_ _37"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 xc h8 yaad ff7 fs4 fc0 sc0 ls0 ws0">NOTE:<span class="_ _20"> </span><span class="ff3">Manually<span class="_ _6"> </span>keeping<span class="_ _6"> </span>track<span class="_ _2"> </span>of<span class="_ _2"> </span>the<span class="_ _2"> </span>lo<span class="_ _5"></span>cation<span class="_ _2"> </span>counter,<span class="_ _2"> </span>as<span class="_ _2"> </span>in<span class="_ _2"> </span>the<span class="_ _3"> </span>previous<span class="_ _2"> </span>example,<span class="_ _2"> </span>is<span class="_ _2"> </span>a<span class="_ _3"> </span>cum-</span></div><div class="t m0 xc h8 yaae ff3 fs4 fc0 sc0 ls0 ws0">b<span class="_ _5"></span>ersome<span class="_ _2"> </span>task<span class="_ _2"> </span>and<span class="_ _2"> </span>can<span class="_ _2"> </span>lead<span class="_ _2"> </span>to<span class="_ _2"> </span>several<span class="_ _6"> </span>problems.<span class="_ _24"> </span>F<span class="_ _9"></span>or<span class="_ _2"> </span>example,<span class="_ _2"> </span>trying<span class="_ _2"> </span>to<span class="_ _2"> </span>keep<span class="_ _6"> </span>track<span class="_ _6"> </span>and<span class="_ _2"> </span>manually</div><div class="t m0 xc h8 yaaf ff3 fs4 fc0 sc0 ls0 ws0">adv<span class="_ _27"></span>ance<span class="_ _2"> </span>the<span class="_ _2"> </span>lo<span class="_ _5"></span>cation<span class="_ _2"> </span>counter<span class="_ _6"> </span>to<span class="_ _2"> </span>ensure<span class="_ _2"> </span>R<span class="_ _9"></span>V32I<span class="_ _2"> </span>instructions<span class="_ _2"> </span>are<span class="_ _2"> </span>aligned<span class="_ _2"> </span>to<span class="_ _2"> </span>4-byte<span class="_ _6"> </span>b<span class="_ _5"></span>oundaries<span class="_ _2"> </span>may</div><div class="t m0 xc h8 yab0 ff3 fs4 fc0 sc0 ls0 ws0">cause<span class="_ _2"> </span>the<span class="_ _2"> </span>assem<span class="_ _1"></span>bler<span class="_ _6"> </span>to<span class="_ _3"> </span>generate<span class="_ _6"> </span>inv<span class="_ _9"></span>alid<span class="_ _2"> </span>co<span class="_ _5"></span>de<span class="_ _2"> </span>without<span class="_ _2"> </span>emitting<span class="_ _2"> </span>warning<span class="_ _6"> </span>nor<span class="_ _2"> </span>error<span class="_ _2"> </span>messages.</div><div class="t m0 xc h8 yab1 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _2"> </span>prop<span class="_ _5"></span>er<span class="_ _3"> </span>wa<span class="_ _27"></span>y<span class="_ _3"> </span>of<span class="_ _2"> </span>ensuring<span class="_ _3"> </span>the<span class="_ _3"> </span>lo<span class="_ _5"></span>cation<span class="_ _2"> </span>counter<span class="_ _2"> </span>is<span class="_ _3"> </span>aligned<span class="_ _3"> </span>is<span class="_ _2"> </span>by<span class="_ _2"> </span>using<span class="_ _3"> </span>the<span class="_ _2"> </span><span class="ff5">.align<span class="_ _4"> </span>N<span class="_ _3"> </span></span>directive.<span class="_ _24"> </span>The</div><div class="t m0 xf h8 yab2 ff5 fs4 fc0 sc0 ls0 ws0">.align<span class="_ _18"> </span>N<span class="_ _7"> </span><span class="ff3">directive<span class="_ _b"> </span>chec<span class="_ _27"></span>ks<span class="_ _7"> </span>if<span class="_ _7"> </span>the<span class="_ _34"> </span>lo<span class="_ _5"></span>cation<span class="_ _7"> </span>counter<span class="_ _b"> </span>is<span class="_ _7"> </span>a<span class="_ _34"> </span>multiple<span class="_ _34"> </span>of<span class="_ _34"> </span>2</span></div><div class="t m0 x87 hc yab3 ffa fs7 fc0 sc0 ls0 ws0">N</div><div class="t m0 x10e h8 yab2 ff3 fs4 fc0 sc0 ls0 ws0">,<span class="_ _7"> </span>if<span class="_ _7"> </span>it<span class="_ _34"> </span>is,<span class="_ _24"> </span>it<span class="_ _34"> </span>has<span class="_ _7"> </span>no<span class="_ _34"> </span>eﬀect<span class="_ _7"> </span>on<span class="_ _34"> </span>the</div><div class="t m0 xf h8 yab4 ff3 fs4 fc0 sc0 ls0 ws0">program,<span class="_ _2"> </span>otherwise,<span class="_ _2"> </span>it<span class="_ _6"> </span>adv<span class="_ _27"></span>ances<span class="_ _2"> </span>the<span class="_ _2"> </span>lo<span class="_ _5"></span>cation<span class="_ _2"> </span>counter<span class="_ _6"> </span>to<span class="_ _2"> </span>the<span class="_ _2"> </span>next<span class="_ _2"> </span>v<span class="_ _27"></span>alue<span class="_ _2"> </span>that<span class="_ _2"> </span>is<span class="_ _2"> </span>a<span class="_ _2"> </span>multiple<span class="_ _6"> </span>of<span class="_ _2"> </span>2</div><div class="t m0 x13e hc yab5 ffa fs7 fc0 sc0 ls0 ws0">N</div><div class="t m0 x96 h8 yab4 ff3 fs4 fc0 sc0 ls0 ws0">.</div><div class="t m0 xc h8 yab6 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _34"> </span>compiler<span class="_ _34"> </span>usually<span class="_ _34"> </span>inserts<span class="_ _34"> </span>a<span class="_ _7"> </span><span class="ff5">.align<span class="_ _4"> </span>2<span class="_ _b"> </span></span>directive</div><div class="t m0 x138 h12 yab7 ffc fs7 fc0 sc0 ls0 ws0">5</div><div class="t m0 xa2 h8 yab6 ff3 fs4 fc0 sc0 ls0 ws0">b<span class="_ _5"></span>efore<span class="_ _34"> </span>routine<span class="_ _34"> </span>lab<span class="_ _5"></span>els<span class="_ _34"> </span>to<span class="_ _34"> </span>ensure<span class="_ _34"> </span>the<span class="_ _7"> </span>routine<span class="_ _34"> </span>in-</div><div class="t m0 xf h8 yab8 ff3 fs4 fc0 sc0 ls0 ws0">structions<span class="_ _6"> </span>start<span class="_ _2"> </span>on<span class="_ _2"> </span>addresses<span class="_ _6"> </span>that<span class="_ _2"> </span>are<span class="_ _2"> </span>multiple<span class="_ _38"> </span>of<span class="_ _2"> </span>four.<span class="_ _7"> </span>The<span class="_ _2"> </span>following<span class="_ _38"> </span>c<span class="_ _5"></span>ode<span class="_ _2"> </span>shows<span class="_ _6"> </span>an<span class="_ _2"> </span>assem<span class="_ _1"></span>bly<span class="_ _6"> </span>co<span class="_ _5"></span>de<span class="_ _2"> </span>that</div><div class="t m0 xf h8 yab9 ff3 fs4 fc0 sc0 ls0 ws0">uses<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">.align<span class="_ _18"> </span>2<span class="_ _2"> </span></span>directive<span class="_ _6"> </span>to<span class="_ _2"> </span>align<span class="_ _2"> </span>the<span class="_ _2"> </span>lo<span class="_ _5"></span>cation<span class="_ _2"> </span>counter<span class="_ _6"> </span>b<span class="_ _5"></span>efore<span class="_ _2"> </span>each<span class="_ _6"> </span>routine.</div><div class="t m0 x114 h9 yaba ff22 fs11 fc0 sc0 ls0 ws0">1<span class="_ _2a"> </span><span class="ff5 fs4">.text</span></div><div class="t m0 x114 h9 yabb ff22 fs11 fc0 sc0 ls0 ws0">2<span class="_ _2a"> </span><span class="ff5 fs4">.align<span class="_ _4"> </span>2</span></div><div class="t m0 x114 h9 yabc ff22 fs11 fc0 sc0 ls0 ws0">3<span class="_ _2a"> </span><span class="ff5 fs4">func1:</span></div><div class="t m0 x114 h9 yabd ff22 fs11 fc0 sc0 ls0 ws0">4<span class="_ _37"> </span><span class="ff5 fs4">addi<span class="_ _18"> </span>a0,<span class="_ _4"> </span>a0,<span class="_ _4"> </span>2</span></div><div class="t m0 x114 h9 yabe ff22 fs11 fc0 sc0 ls0 ws0">5<span class="_ _37"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 x114 h9 yabf ff22 fs11 fc0 sc0 ls0 ws0">6<span class="_ _2a"> </span><span class="ff5 fs4">.align<span class="_ _4"> </span>2</span></div><div class="t m0 x114 h9 yac0 ff22 fs11 fc0 sc0 ls0 ws0">7<span class="_ _2a"> </span><span class="ff5 fs4">func2:</span></div><div class="t m0 x114 h9 yac1 ff22 fs11 fc0 sc0 ls0 ws0">8<span class="_ _37"> </span><span class="ff5 fs4">addi<span class="_ _18"> </span>a0,<span class="_ _4"> </span>a0,<span class="_ _4"> </span>42</span></div><div class="t m0 x114 h9 yac2 ff22 fs11 fc0 sc0 ls0 ws0">9<span class="_ _37"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 xc h8 yac3 ff3 fs4 fc0 sc0 ls0 ws0">Notice that,<span class="_ _6"> </span>if the<span class="_ _38"> </span>lo<span class="_ _5"></span>cation<span class="_ _6"> </span>coun<span class="_ _1"></span>ter already<span class="_ _38"> </span>contains a v<span class="_ _27"></span>alue<span class="_ _6"> </span>that is a<span class="_ _6"> </span>multiple of 2</div><div class="t m0 xc1 hc yac4 ffa fs7 fc0 sc0 ls0 ws0">N</div><div class="t m0 x8 h8 yac3 ff3 fs4 fc0 sc0 ls0 ws0">, then<span class="_ _6"> </span>the <span class="ff5">.align</span></div><div class="t m0 xf h8 yac5 ff5 fs4 fc0 sc0 ls0 ws0">N<span class="_ _3"> </span><span class="ff3">directive<span class="_ _2"> </span>has<span class="_ _3"> </span>no<span class="_ _b"> </span>eﬀect<span class="_ _3"> </span>on<span class="_ _3"> </span>the<span class="_ _3"> </span>lo<span class="_ _5"></span>cation<span class="_ _b"> </span>coun<span class="_ _1"></span>ter.<span class="_ _4"> </span>Hence,<span class="_ _b"> </span>since<span class="_ _3"> </span>the<span class="_ _3"> </span>co<span class="_ _5"></span>de<span class="_ _b"> </span>in<span class="_ _3"> </span>the<span class="_ _3"> </span>previous<span class="_ _3"> </span>example<span class="_ _b"> </span>starts</span></div><div class="t m0 x2b h1e y142 fff fsd fc0 sc0 ls0 ws0">5</div><div class="t m0 xc h1f ye2 ff10 fse fc0 sc0 ls0 ws0">The<span class="_ _38"> </span><span class="ff28">.align<span class="_ _34"> </span>2<span class="_ _38"> </span></span>directive<span class="_ _8b"> </span>aligns<span class="_ _38"> </span>the<span class="_ _38"> </span>lo<span class="_ _5"></span>cation<span class="_ _38"> </span>counter<span class="_ _8b"> </span>to<span class="_ _38"> </span>a<span class="_ _38"> </span>multiple<span class="_ _8b"> </span>of<span class="_ _38"> </span>four<span class="_ _38"> </span>(2</div><div class="t m0 xa3 h1e y142 fff fsd fc0 sc0 ls0 ws0">2</div><div class="t m0 x70 h1f ye2 ff10 fse fc0 sc0 ls0 ws0">).</div><div class="t m0 x2c h8 y33 ff3 fs4 fc0 sc0 ls0 ws0">Prin<span class="_ _1"></span>ted<span class="_ _2"> </span>v<span class="_ _1"></span>ersion<span class="_ _2"> </span>a<span class="_ _1"></span>v<span class="_ _27"></span>ailable<span class="_ _2"> </span>for<span class="_ _6"> </span>purchase<span class="_ _6"> </span>at<span class="_ _2"> </span>Amazon.com</div><div class="t m0 x2d h8 y143 ff3 fs4 fc0 sc0 ls0 ws0">F<span class="_ _9"></span>ree<span class="_ _2"> </span>online<span class="_ _6"> </span>version<span class="_ _6"> </span>at<span class="_ _2"> </span><span class="ff5">http://riscv-<span class="_ _22"></span>programming.org</span></div><div class="t m0 x2e h8 y144 ff3 fs4 fc0 sc0 ls0 ws0">(Generated<span class="_ _2"> </span>on<span class="_ _2"> </span>F<span class="_ _9"></span>ebruary<span class="_ _2"> </span>10,<span class="_ _6"> </span>2025)</div><div class="t m0 xb8 h8 y33 ff3 fs4 fc0 sc0 ls0 ws0">54</div><a class="l" href="#pfa" data-dest-detail='[10,"XYZ",72,514.708,null]'><div class="d m1" style="border-style:none;position:absolute;left:413.509000px;bottom:627.052000px;width:23.440000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfa" data-dest-detail='[10,"XYZ",72,552.649,null]'><div class="d m1" style="border-style:none;position:absolute;left:377.891000px;bottom:566.722000px;width:14.169000px;height:11.955000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfa" data-dest-detail='[10,"XYZ",72,514.708,null]'><div class="d m1" style="border-style:none;position:absolute;left:401.127000px;bottom:555.321000px;width:23.440000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pf43" data-dest-detail='[67,"XYZ",87.243,111.352,null]'><div class="d m1" style="border-style:none;position:absolute;left:308.628000px;bottom:302.033000px;width:6.462000px;height:12.316000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="https://a.co/d/gUfKWsD"><div class="d m1" style="border-style:none;position:absolute;left:358.258000px;bottom:69.067000px;width:58.171000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:271.722000px;bottom:56.835000px;width:148.940000px;height:11.125000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
