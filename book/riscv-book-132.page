<div id="pf84" class="pf w0 h0" data-page-no="84"><div class="pc pc84 w0 h0"><img class="bi xf y1348 w2 hf7" alt="" src="bg84.png"/><div class="t m0 xf h8 y105 ff3 fs4 fc0 sc0 ls0 ws0">8.4.<span class="_ _1f"> </span>BUSY<span class="_ _2"> </span>W<span class="_ _12"></span>AITING</div><div class="t m0 xf h8 y57 ff3 fs4 fc0 sc0 ls0 ws0">than once<span class="_ _6"> </span>since<span class="_ _38"> </span>the<span class="_ _6"> </span>last<span class="_ _6"> </span>time the<span class="_ _6"> </span>CPU<span class="_ _38"> </span>read<span class="_ _6"> </span>a<span class="_ _38"> </span>v<span class="_ _1"></span>alue from<span class="_ _6"> </span>the data<span class="_ _6"> </span>register.<span class="_ _7"> </span>Notice that,<span class="_ _6"> </span>since<span class="_ _6"> </span>the keypad</div><div class="t m0 xf h8 y86 ff3 fs4 fc0 sc0 ls0 ws0">con<span class="_ _1"></span>troller<span class="_ _3"> </span>contains<span class="_ _2"> </span>only<span class="_ _3"> </span>one<span class="_ _3"> </span>data<span class="_ _3"> </span>register,<span class="_ _3"> </span>and<span class="_ _b"> </span>it<span class="_ _2"> </span>stores<span class="_ _b"> </span>the<span class="_ _3"> </span>v<span class="_ _27"></span>alue<span class="_ _3"> </span>of<span class="_ _3"> </span>the<span class="_ _3"> </span>last<span class="_ _3"> </span>key<span class="_ _2"> </span>pressed,<span class="_ _3"> </span>if<span class="_ _3"> </span>the<span class="_ _3"> </span>keypad</div><div class="t m0 xf h8 y87 ff3 fs4 fc0 sc0 ls0 ws0">is<span class="_ _b"> </span>pressed<span class="_ _3"> </span>more<span class="_ _b"> </span>than<span class="_ _b"> </span>once<span class="_ _b"> </span>b<span class="_ _5"></span>efore<span class="_ _b"> </span>the<span class="_ _b"> </span>CPU<span class="_ _b"> </span>gets<span class="_ _b"> </span>the<span class="_ _b"> </span>c<span class="_ _1"></span>hance<span class="_ _b"> </span>to<span class="_ _3"> </span>read<span class="_ _b"> </span>the<span class="_ _b"> </span>data<span class="_ _b"> </span>register,<span class="_ _b"> </span>one<span class="_ _b"> </span>or<span class="_ _b"> </span>more<span class="_ _b"> </span>key</div><div class="t m0 xf h8 y88 ff3 fs4 fc0 sc0 ls0 ws0">v<span class="_ _27"></span>alues<span class="_ _6"> </span>will<span class="_ _6"> </span>b<span class="_ _5"></span>e<span class="_ _6"> </span>lost.<span class="_ _34"> </span>This<span class="_ _6"> </span>situation,<span class="_ _6"> </span>known<span class="_ _38"> </span>as<span class="_ _6"> </span>ov<span class="_ _27"></span>errun<span class="_ _6"> </span>(OVRN),<span class="_ _38"> </span>may<span class="_ _38"> </span>b<span class="_ _5"></span>e<span class="_ _6"> </span>detected<span class="_ _6"> </span>by insp<span class="_ _5"></span>ecting<span class="_ _6"> </span>the<span class="_ _6"> </span>status</div><div class="t m0 xf h8 y89 ff3 fs4 fc0 sc0 ls0 ws0">register’s<span class="_ _2"> </span>O<span class="_ _1"></span>VRN<span class="_ _2"> </span>bit.</div><div class="t m0 xc h8 y8a ff3 fs4 fc0 sc0 ls0 ws0">No<span class="_ _1"></span>w,<span class="_ _34"> </span>let<span class="_ _b"> </span>us<span class="_ _b"> </span>supp<span class="_ _5"></span>ose<span class="_ _34"> </span>the<span class="_ _b"> </span>programmer<span class="_ _b"> </span>needs<span class="_ _34"> </span>to<span class="_ _b"> </span>implement<span class="_ _b"> </span>a<span class="_ _b"> </span>routine<span class="_ _b"> </span>called<span class="_ _34"> </span><span class="ff5">read<span class="_ _3"> </span>keypad<span class="_ _34"> </span></span>that<span class="_ _b"> </span>waits</div><div class="t m0 xf h8 y8b ff3 fs4 fc0 sc0 ls0 ws0">un<span class="_ _1"></span>til<span class="_ _3"> </span>the<span class="_ _3"> </span>keypad<span class="_ _2"> </span>is<span class="_ _b"> </span>pressed<span class="_ _3"> </span>and<span class="_ _3"> </span>then<span class="_ _3"> </span>returns<span class="_ _3"> </span>the<span class="_ _b"> </span>v<span class="_ _9"></span>alue<span class="_ _b"> </span>of<span class="_ _3"> </span>the<span class="_ _3"> </span>last<span class="_ _3"> </span>key<span class="_ _2"> </span>pressed.<span class="_ _2a"> </span>This<span class="_ _3"> </span>routine<span class="_ _3"> </span>also<span class="_ _3"> </span>needs</div><div class="t m0 xf h8 y224 ff3 fs4 fc0 sc0 ls0 ws0">to<span class="_ _6"> </span>return<span class="_ _2"> </span>the<span class="_ _6"> </span>v<span class="_ _27"></span>alue<span class="_ _2"> </span>-1<span class="_ _6"> </span>if<span class="_ _2"> </span>the<span class="_ _6"> </span>keypad<span class="_ _6"> </span>w<span class="_ _1"></span>as<span class="_ _6"> </span>pressed<span class="_ _2"> </span>more<span class="_ _6"> </span>than<span class="_ _2"> </span>once<span class="_ _6"> </span>since<span class="_ _2"> </span>a<span class="_ _6"> </span>v<span class="_ _27"></span>alue<span class="_ _2"> </span>was read<span class="_ _2"> </span>from<span class="_ _6"> </span>the<span class="_ _2"> </span>keypad</div><div class="t m0 xf h8 y225 ff3 fs4 fc0 sc0 ls0 ws0">con<span class="_ _1"></span>troller’s<span class="_ _6"> </span>data<span class="_ _6"> </span>register.<span class="_ _7"> </span>The<span class="_ _2"> </span>following co<span class="_ _5"></span>de<span class="_ _2"> </span>shows an<span class="_ _2"> </span>implementation of<span class="_ _2"> </span>the<span class="_ _6"> </span><span class="ff5">read<span class="_ _b"> </span>keypad<span class="_ _6"> </span></span>routine<span class="_ _6"> </span>that</div><div class="t m0 xf h8 y226 ff3 fs4 fc0 sc0 ls0 ws0">emplo<span class="_ _1"></span>ys<span class="_ _7"> </span>the<span class="_ _7"> </span>busy<span class="_ _7"> </span>waiting<span class="_ _34"> </span>technique<span class="_ _34"> </span>to<span class="_ _7"> </span>wai<span class="_ _1"></span>t<span class="_ _7"> </span>for<span class="_ _7"> </span>the<span class="_ _7"> </span>keypad<span class="_ _34"> </span>to<span class="_ _7"> </span>b<span class="_ _5"></span>e<span class="_ _7"> </span>pressed<span class="_ _7"> </span>b<span class="_ _5"></span>efore<span class="_ _7"> </span>reading<span class="_ _7"> </span>the<span class="_ _7"> </span>keypad</div><div class="t m0 xf h8 yc2 ff3 fs4 fc0 sc0 ls0 ws0">con<span class="_ _1"></span>troller’s<span class="_ _6"> </span>data<span class="_ _6"> </span>register.<span class="_ _7"> </span>First,<span class="_ _2"> </span>it<span class="_ _6"> </span>reads<span class="_ _2"> </span>the<span class="_ _6"> </span>conten<span class="_ _27"></span>ts<span class="_ _2"> </span>of<span class="_ _6"> </span>the<span class="_ _2"> </span>k<span class="_ _1"></span>eypad<span class="_ _6"> </span>status<span class="_ _6"> </span>register<span class="_ _2"> </span>into register<span class="_ _2"> </span><span class="ff5">a0<span class="_ _6"> </span></span>(lines</div><div class="t m0 xf h8 y1d ff3 fs4 fc0 sc0 ls0 ws0">8<span class="_ _6"> </span>and<span class="_ _2"> </span>9)<span class="_ _2"> </span>and<span class="_ _2"> </span>then<span class="_ _6"> </span>it<span class="_ _2"> </span>chec<span class="_ _27"></span>ks<span class="_ _2"> </span>whether<span class="_ _2"> </span>the<span class="_ _6"> </span>READY<span class="_ _6"> </span>bit<span class="_ _2"> </span>is<span class="_ _2"> </span>set<span class="_ _6"> </span>by<span class="_ _6"> </span>p<span class="_ _5"></span>erforming<span class="_ _2"> </span>a<span class="_ _2"> </span>bit-wise<span class="_ _6"> </span>and<span class="_ _2"> </span>op<span class="_ _5"></span>eration<span class="_ _2"> </span>with</div><div class="t m0 xf h8 y1e ff3 fs4 fc0 sc0 ls0 ws0">the mask<span class="_ _a"> </span>deﬁned b<span class="_ _1"></span>y the<span class="_ _a"> </span><span class="ff5">READY<span class="_ _b"> </span>MASK<span class="_ _8b"> </span></span>sym<span class="_ _1"></span>b<span class="_ _5"></span>ol (line<span class="_ _a"> </span>10) and jumping<span class="_ _a"> </span>back<span class="_ _a"> </span>to the beginning of the<span class="_ _a"> </span>routine in</div><div class="t m0 xf h8 y1f ff3 fs4 fc0 sc0 ls0 ws0">case<span class="_ _6"> </span>the<span class="_ _6"> </span>result<span class="_ _6"> </span>is<span class="_ _6"> </span>zero<span class="_ _6"> </span>(line<span class="_ _6"> </span>11).<span class="_ _7"> </span>Next,<span class="_ _6"> </span>it<span class="_ _6"> </span>chec<span class="_ _27"></span>ks<span class="_ _6"> </span>if<span class="_ _6"> </span>the<span class="_ _6"> </span>keypad<span class="_ _38"> </span>was<span class="_ _38"> </span>pressed<span class="_ _6"> </span>more<span class="_ _2"> </span>than<span class="_ _6"> </span>once<span class="_ _6"> </span>by p<span class="_ _5"></span>erforming</div><div class="t m0 xf h8 y20 ff3 fs4 fc0 sc0 ls0 ws0">a<span class="_ _2"> </span>bit-wise<span class="_ _3"> </span>and<span class="_ _3"> </span>op<span class="_ _5"></span>eration<span class="_ _3"> </span>with<span class="_ _2"> </span>the<span class="_ _3"> </span>mask<span class="_ _3"> </span>deﬁned<span class="_ _3"> </span>b<span class="_ _1"></span>y<span class="_ _2"> </span>the<span class="_ _3"> </span><span class="ff5">OVRN<span class="_ _b"> </span>MASK<span class="_ _2"> </span></span>symbol<span class="_ _3"> </span>(line<span class="_ _3"> </span>12)<span class="_ _3"> </span>and<span class="_ _2"> </span>jumping<span class="_ _3"> </span>to<span class="_ _3"> </span>the</div><div class="t m0 xf h8 y21 ff5 fs4 fc0 sc0 ls0 ws0">ovrn<span class="_ _3"> </span>occured<span class="_ _38"> </span><span class="ff3">lab<span class="_ _5"></span>el in case<span class="_ _a"> </span>the result is not zero<span class="_ _a"> </span>(line 13).<span class="_ _34"> </span>Finally<span class="_ _9"></span>, it reads the k<span class="_ _27"></span>ey v<span class="_ _27"></span>alue from the k<span class="_ _27"></span>eypad</span></div><div class="t m0 xf h8 y22 ff3 fs4 fc0 sc0 ls0 ws0">con<span class="_ _1"></span>troller’s<span class="_ _2"> </span>data<span class="_ _2"> </span>register<span class="_ _6"> </span>(lines<span class="_ _3"> </span>14<span class="_ _6"> </span>and<span class="_ _2"> </span>15)<span class="_ _2"> </span>and<span class="_ _2"> </span>returns.</div><div class="t m0 x116 h9 y1349 ff22 fs11 fc0 sc0 ls0 ws0">1<span class="_ _2a"> </span><span class="ff5 fs4">.text</span></div><div class="t m0 x116 h9 y134a ff22 fs11 fc0 sc0 ls0 ws0">2<span class="_ _2a"> </span><span class="ff5 fs4">.set<span class="_ _79"> </span>DATA_REG_PORT,<span class="_ _18"> </span>0x00000050</span></div><div class="t m0 x116 h9 y134b ff22 fs11 fc0 sc0 ls0 ws0">3<span class="_ _2a"> </span><span class="ff5 fs4">.set<span class="_ _79"> </span>STAT_REG_PORT,<span class="_ _18"> </span>0x00000054</span></div><div class="t m0 x116 h9 y134c ff22 fs11 fc0 sc0 ls0 ws0">4<span class="_ _2a"> </span><span class="ff5 fs4">.set<span class="_ _79"> </span>READY_MASK,<span class="_ _86"> </span>0b00000001</span></div><div class="t m0 x116 h9 y134d ff22 fs11 fc0 sc0 ls0 ws0">5<span class="_ _2a"> </span><span class="ff5 fs4">.set<span class="_ _79"> </span>OVRN_MASK,<span class="_ _8c"> </span>0b00000010</span></div><div class="t m0 x116 h39 y134e ff22 fs11 fc0 sc0 ls0 ws0">6</div><div class="t m0 x116 h9 y134f ff22 fs11 fc0 sc0 ls0 ws0">7<span class="_ _2a"> </span><span class="ff5 fs4">read_keypad:</span></div><div class="t m0 x116 h9 y1350 ff22 fs11 fc0 sc0 ls0 ws0">8<span class="_ _37"> </span><span class="ff5 fs4">li<span class="_ _3f"> </span>a0,<span class="_ _4"> </span>STAT_REG_PORT<span class="_ _16"> </span>#<span class="_ _4"> </span>read<span class="_ _4"> </span>the<span class="_ _4"> </span>keypad</span></div><div class="t m0 x116 h9 y1351 ff22 fs11 fc0 sc0 ls0 ws0">9<span class="_ _37"> </span><span class="ff5 fs4">lb<span class="_ _3f"> </span>a0,<span class="_ _4"> </span>0(a0)<span class="_ _93"> </span>#<span class="_ _16"> </span>status<span class="_ _4"> </span>into<span class="_ _4"> </span>a0</span></div><div class="t m0 x126 h9 y1352 ff22 fs11 fc0 sc0 ls0 ws0">10<span class="_ _37"> </span><span class="ff5 fs4">andi<span class="_ _18"> </span>t0,<span class="_ _4"> </span>a0,<span class="_ _4"> </span>READY_MASK<span class="_ _4"> </span>#<span class="_ _18"> </span>check<span class="_ _4"> </span>the<span class="_ _4"> </span>READY<span class="_ _4"> </span>bit<span class="_ _4"> </span>and</span></div><div class="t m0 x126 h9 y1353 ff22 fs11 fc0 sc0 ls0 ws0">11<span class="_ _37"> </span><span class="ff5 fs4">beqz<span class="_ _18"> </span>t0,<span class="_ _4"> </span>read_keypad<span class="_ _9a"> </span>#<span class="_ _79"> </span>loop<span class="_ _18"> </span>until<span class="_ _4"> </span>it<span class="_ _4"> </span>is<span class="_ _4"> </span>equal<span class="_ _18"> </span>to<span class="_ _4"> </span>1</span></div><div class="t m0 x126 h9 y1354 ff22 fs11 fc0 sc0 ls0 ws0">12<span class="_ _37"> </span><span class="ff5 fs4">andi<span class="_ _18"> </span>t0,<span class="_ _4"> </span>a0,<span class="_ _4"> </span>OVRN_MASK<span class="_ _79"> </span>#<span class="_ _18"> </span>check<span class="_ _4"> </span>the<span class="_ _4"> </span>OVRN<span class="_ _18"> </span>bit<span class="_ _4"> </span>and<span class="_ _4"> </span>jump<span class="_ _4"> </span>to</span></div><div class="t m0 x126 h9 y1355 ff22 fs11 fc0 sc0 ls0 ws0">13<span class="_ _37"> </span><span class="ff5 fs4">bnez<span class="_ _18"> </span>t0,<span class="_ _4"> </span>ovrn_occured<span class="_ _3f"> </span>#<span class="_ _79"> </span>ovrn_occured<span class="_ _18"> </span>if<span class="_ _4"> </span>it<span class="_ _4"> </span>is<span class="_ _4"> </span>equal<span class="_ _18"> </span>to<span class="_ _4"> </span>1</span></div><div class="t m0 x126 h9 y1356 ff22 fs11 fc0 sc0 ls0 ws0">14<span class="_ _37"> </span><span class="ff5 fs4">la<span class="_ _3f"> </span>a0,<span class="_ _4"> </span>DATA_REG_PORT<span class="_ _16"> </span>#<span class="_ _4"> </span>read<span class="_ _4"> </span>the<span class="_ _4"> </span>key<span class="_ _18"> </span>from<span class="_ _4"> </span>the</span></div><div class="t m0 x126 h9 y1357 ff22 fs11 fc0 sc0 ls0 ws0">15<span class="_ _37"> </span><span class="ff5 fs4">lb<span class="_ _3f"> </span>a0,<span class="_ _4"> </span>0(a0)<span class="_ _93"> </span>#<span class="_ _16"> </span>data<span class="_ _4"> </span>register<span class="_ _4"> </span>into<span class="_ _18"> </span>a0</span></div><div class="t m0 x126 h9 y1358 ff22 fs11 fc0 sc0 ls0 ws0">16<span class="_ _37"> </span><span class="ff5 fs4">ret<span class="_ _ba"> </span>#<span class="_ _18"> </span>return</span></div><div class="t m0 x126 h9 y1359 ff22 fs11 fc0 sc0 ls0 ws0">17<span class="_ _2a"> </span><span class="ff5 fs4">ovrn_occured:</span></div><div class="t m0 x126 h9 y135a ff22 fs11 fc0 sc0 ls0 ws0">18<span class="_ _37"> </span><span class="ff5 fs4">li<span class="_ _3f"> </span>a0,<span class="_ _4"> </span>-1<span class="_ _96"> </span>#<span class="_ _18"> </span>set<span class="_ _4"> </span>return<span class="_ _4"> </span>value<span class="_ _4"> </span>to<span class="_ _16"> </span>-1</span></div><div class="t m0 x126 h9 y135b ff22 fs11 fc0 sc0 ls0 ws0">19<span class="_ _37"> </span><span class="ff5 fs4">ret<span class="_ _ba"> </span>#<span class="_ _18"> </span>return</span></div><div class="t m0 xc h8 y135c ff3 fs4 fc0 sc0 ls0 ws0">Busy<span class="_ _b"> </span>waiting<span class="_ _b"> </span>is<span class="_ _b"> </span>a<span class="_ _34"> </span>simple<span class="_ _34"> </span>technique,<span class="_ _b"> </span>but<span class="_ _34"> </span>it<span class="_ _b"> </span>may<span class="_ _b"> </span>b<span class="_ _5"></span>e<span class="_ _b"> </span>very<span class="_ _b"> </span>ineﬃcient<span class="_ _b"> </span>b<span class="_ _5"></span>ecause<span class="_ _b"> </span>it<span class="_ _34"> </span>keeps<span class="_ _3"> </span>the<span class="_ _34"> </span>CPU<span class="_ _34"> </span>busy</div><div class="t m0 xf h8 y135d ff3 fs4 fc0 sc0 ls0 ws0">un<span class="_ _1"></span>til<span class="_ _2"> </span>the<span class="_ _3"> </span>release<span class="_ _3"> </span>condition<span class="_ _3"> </span>b<span class="_ _5"></span>ecomes<span class="_ _3"> </span>true<span class="_ _2"> </span>(<span class="ff8">e.g.</span>,<span class="_ _3"> </span>a<span class="_ _3"> </span>key<span class="_ _2"> </span>is<span class="_ _3"> </span>pressed).<span class="_ _18"> </span>The<span class="_ _3"> </span>next<span class="_ _3"> </span>chapter<span class="_ _6"> </span>discusses<span class="_ _3"> </span>techniques</div><div class="t m0 xf h8 y135e ff3 fs4 fc0 sc0 ls0 ws0">(p<span class="_ _5"></span>olling<span class="_ _2"> </span>and<span class="_ _2"> </span>interrupts)<span class="_ _6"> </span>that<span class="_ _2"> </span>can<span class="_ _2"> </span>b<span class="_ _5"></span>e<span class="_ _2"> </span>employ<span class="_ _27"></span>ed<span class="_ _2"> </span>to<span class="_ _2"> </span>release<span class="_ _2"> </span>the<span class="_ _3"> </span>CPU<span class="_ _2"> </span>to<span class="_ _2"> </span>p<span class="_ _5"></span>erform<span class="_ _2"> </span>useful<span class="_ _2"> </span>work<span class="_ _6"> </span>while<span class="_ _2"> </span>waiting</div><div class="t m0 xf h8 y135f ff3 fs4 fc0 sc0 ls0 ws0">for<span class="_ _2"> </span>the<span class="_ _2"> </span>release<span class="_ _6"> </span>condition<span class="_ _2"> </span>to<span class="_ _2"> </span>b<span class="_ _5"></span>ecome<span class="_ _2"> </span>true.</div><div class="t m0 x2c h8 y33 ff3 fs4 fc0 sc0 ls0 ws0">Prin<span class="_ _1"></span>ted<span class="_ _2"> </span>v<span class="_ _1"></span>ersion<span class="_ _2"> </span>a<span class="_ _1"></span>v<span class="_ _27"></span>ailable<span class="_ _2"> </span>for<span class="_ _6"> </span>purchase<span class="_ _6"> </span>at<span class="_ _2"> </span>Amazon.com</div><div class="t m0 x2d h8 y13b ff3 fs4 fc0 sc0 ls0 ws0">F<span class="_ _9"></span>ree<span class="_ _2"> </span>online<span class="_ _6"> </span>version<span class="_ _6"> </span>at<span class="_ _2"> </span><span class="ff5">http://riscv-<span class="_ _22"></span>programming.org</span></div><div class="t m0 x2e h8 y13c ff3 fs4 fc0 sc0 ls0 ws0">(Generated<span class="_ _2"> </span>on<span class="_ _2"> </span>Septem<span class="_ _1"></span>b<span class="_ _5"></span>er<span class="_ _6"> </span>17,<span class="_ _2"> </span>2025)</div><div class="t m0 x9c h8 y33 ff3 fs4 fc0 sc0 ls0 ws0">119</div><a class="l" href="#pfa" data-dest-detail='[10,"XYZ",72,514.708,null]'><div class="d m1" style="border-style:none;position:absolute;left:214.667000px;bottom:720.132000px;width:23.440000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfa" data-dest-detail='[10,"XYZ",72,514.708,null]'><div class="d m1" style="border-style:none;position:absolute;left:237.939000px;bottom:696.221000px;width:23.440000px;height:10.849000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfa" data-dest-detail='[10,"XYZ",72,552.649,null]'><div class="d m1" style="border-style:none;position:absolute;left:146.305000px;bottom:672.311000px;width:14.169000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfa" data-dest-detail='[10,"XYZ",72,552.649,null]'><div class="d m1" style="border-style:none;position:absolute;left:288.158000px;bottom:588.071000px;width:14.169000px;height:11.956000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="https://a.co/d/gUfKWsD"><div class="d m1" style="border-style:none;position:absolute;left:358.258000px;bottom:69.067000px;width:58.171000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:271.722000px;bottom:56.835000px;width:148.940000px;height:11.125000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
