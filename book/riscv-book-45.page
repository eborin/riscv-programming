<div id="pf2d" class="pf w0 h0" data-page-no="2d"><div class="pc pc2d w0 h0"><img class="bi xf y780 w2 h72" alt="" src="bg2d.png"/><div class="t m0 xf h8 y10b ff3 fs4 fc0 sc0 ls0 ws0">3.2.<span class="_ _1f"> </span>LABELS,<span class="_ _2"> </span>SYMBOLS,<span class="_ _2"> </span>REFERENCES,<span class="_ _2"> </span>AND<span class="_ _2"> </span>RELOCA<span class="_ _9"></span>TION</div><div class="t m0 xf h9 y57 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _18"> </span>riscv64-unknown-elf-nm<span class="_ _4"> </span>main.o</div><div class="t m0 xf h9 y86 ff5 fs4 fc0 sc0 ls0 ws0">00000000<span class="_ _18"> </span>t<span class="_ _4"> </span>start</div><div class="t m0 x22 h9 y87 ff5 fs4 fc0 sc0 ls0 ws0">U<span class="_ _18"> </span>exit</div><div class="t m0 xc h8 y781 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _3"> </span>assem<span class="_ _1"></span>bler<span class="_ _3"> </span>also<span class="_ _3"> </span>register<span class="_ _3"> </span>the<span class="_ _3"> </span>reference<span class="_ _3"> </span>to<span class="_ _3"> </span>this<span class="_ _3"> </span>symbol<span class="_ _3"> </span>on<span class="_ _3"> </span>the<span class="_ _3"> </span>relo<span class="_ _5"></span>cation<span class="_ _3"> </span>table.<span class="_ _4"> </span>The<span class="_ _3"> </span>disassembling</div><div class="t m0 xf h8 y782 ff3 fs4 fc0 sc0 ls0 ws0">to<span class="_ _5"></span>ol (<span class="ff5">riscv64-unknown-elf-objdump</span>)<span class="_ _6"> </span>sho<span class="_ _1"></span>ws that<span class="_ _6"> </span>the <span class="ff5">main.o<span class="_ _6"> </span></span>ob<span class="_ _22"></span>ject ﬁle<span class="_ _38"> </span>includes<span class="_ _6"> </span>a relo<span class="_ _5"></span>cation<span class="_ _6"> </span>record<span class="_ _38"> </span>for</div><div class="t m0 xf h8 y783 ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _2"> </span>reference<span class="_ _2"> </span>to<span class="_ _6"> </span>the<span class="_ _2"> </span><span class="ff5">exit<span class="_ _2"> </span></span>lab<span class="_ _5"></span>el<span class="_ _2"> </span>on<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">jal<span class="_ _2"> </span></span>instruction.</div><div class="t m0 xf h9 y784 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _18"> </span>riscv64-unknown-elf-objdump<span class="_ _4"> </span>-r<span class="_ _4"> </span>main.o</div><div class="t m0 xf h9 y785 ff5 fs4 fc0 sc0 ls0 ws0">main.o:<span class="_ _8a"> </span>file<span class="_ _18"> </span>format<span class="_ _4"> </span>elf32-littleriscv</div><div class="t m0 xf h9 y786 ff5 fs4 fc0 sc0 ls0 ws0">RELOCATION<span class="_ _18"> </span>RECORDS<span class="_ _4"> </span>FOR<span class="_ _4"> </span>[.text]:</div><div class="t m0 xf h9 y787 ff5 fs4 fc0 sc0 ls0 ws0">OFFSET<span class="_ _3f"> </span>TYPE<span class="_ _50"> </span>VALUE</div><div class="t m0 xf h9 y788 ff5 fs4 fc0 sc0 ls0 ws0">00000008<span class="_ _18"> </span>R_RISCV_JAL<span class="_ _69"> </span>exit</div><div class="t m0 xc h8 y789 ff3 fs4 fc0 sc0 ls0 ws0">When<span class="_ _b"> </span>linking<span class="_ _b"> </span>the<span class="_ _b"> </span>ob<span class="_ _22"></span>ject<span class="_ _b"> </span>ﬁles,<span class="_ _b"> </span>the<span class="_ _b"> </span>linker<span class="_ _3"> </span>must<span class="_ _b"> </span>resolv<span class="_ _1"></span>e<span class="_ _b"> </span>the<span class="_ _b"> </span>undeﬁned<span class="_ _b"> </span>symbols,<span class="_ _b"> </span><span class="ff8">i.e.</span>,<span class="_ _34"> </span>it<span class="_ _b"> </span>must<span class="_ _3"> </span>ﬁnd<span class="_ _34"> </span>the</div><div class="t m0 xf h8 y78a ff3 fs4 fc0 sc0 ls0 ws0">sym<span class="_ _1"></span>b<span class="_ _5"></span>ol<span class="_ _34"> </span>deﬁnition<span class="_ _7"> </span>and<span class="_ _34"> </span>adjust<span class="_ _7"> </span>the<span class="_ _7"> </span>sym<span class="_ _1"></span>b<span class="_ _5"></span>ol<span class="_ _34"> </span>table<span class="_ _7"> </span>and<span class="_ _34"> </span>the<span class="_ _7"> </span>co<span class="_ _5"></span>de<span class="_ _7"> </span>with<span class="_ _34"> </span>the<span class="_ _7"> </span>symbol<span class="_ _7"> </span>v<span class="_ _27"></span>alue.<span class="_ _0"> </span>In<span class="_ _34"> </span>the<span class="_ _7"> </span>previous</div><div class="t m0 xf h8 y78b ff3 fs4 fc0 sc0 ls0 ws0">example,<span class="_ _b"> </span>the<span class="_ _b"> </span>linker<span class="_ _3"> </span>will<span class="_ _b"> </span>look<span class="_ _b"> </span>for<span class="_ _b"> </span>the<span class="_ _b"> </span><span class="ff5">exit<span class="_ _b"> </span></span>symbol<span class="_ _b"> </span>so<span class="_ _b"> </span>that<span class="_ _3"> </span>it<span class="_ _b"> </span>can<span class="_ _b"> </span>adjust<span class="_ _b"> </span>the<span class="_ _b"> </span><span class="ff5">jal<span class="_ _b"> </span></span>instruction<span class="_ _3"> </span>to<span class="_ _b"> </span>refer<span class="_ _b"> </span>to</div><div class="t m0 xf h8 y78c ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _2"> </span>correct<span class="_ _2"> </span>address.<span class="_ _24"> </span>In<span class="_ _3"> </span>case<span class="_ _2"> </span>it<span class="_ _2"> </span>cannot<span class="_ _3"> </span>ﬁnd<span class="_ _2"> </span>the<span class="_ _3"> </span>deﬁnition<span class="_ _2"> </span>of<span class="_ _2"> </span>the<span class="_ _3"> </span>sym<span class="_ _1"></span>b<span class="_ _5"></span>ol,<span class="_ _2"> </span>it<span class="_ _2"> </span>stops<span class="_ _3"> </span>the<span class="_ _2"> </span>linking<span class="_ _2"> </span>pro<span class="_ _5"></span>cess<span class="_ _3"> </span>and</div><div class="t m0 xf h8 y78d ff3 fs4 fc0 sc0 ls0 ws0">emits<span class="_ _3"> </span>an<span class="_ _3"> </span>error<span class="_ _3"> </span>message.<span class="_ _4"> </span>The<span class="_ _3"> </span>following<span class="_ _2"> </span>example<span class="_ _3"> </span>illustrates<span class="_ _3"> </span>this<span class="_ _3"> </span>situation.<span class="_ _4"> </span>In<span class="_ _3"> </span>this<span class="_ _b"> </span>case,<span class="_ _3"> </span>we<span class="_ _2"> </span>are<span class="_ _3"> </span>trying<span class="_ _3"> </span>to</div><div class="t m0 xf h8 y78e ff3 fs4 fc0 sc0 ls0 ws0">link<span class="_ _b"> </span>the<span class="_ _b"> </span><span class="ff5">main.o<span class="_ _b"> </span></span>ﬁle<span class="_ _b"> </span>without<span class="_ _b"> </span>providing<span class="_ _3"> </span>another<span class="_ _b"> </span>ob<span class="_ _22"></span>ject<span class="_ _b"> </span>ﬁle<span class="_ _b"> </span>that<span class="_ _b"> </span>contains<span class="_ _b"> </span>a<span class="_ _b"> </span>deﬁnition<span class="_ _b"> </span>of<span class="_ _b"> </span>the<span class="_ _b"> </span><span class="ff5">exit<span class="_ _b"> </span></span>lab<span class="_ _5"></span>el.</div><div class="t m0 xf h8 y78f ff3 fs4 fc0 sc0 ls0 ws0">Notice<span class="_ _2"> </span>that<span class="_ _2"> </span>the<span class="_ _6"> </span>linker<span class="_ _6"> </span>emits<span class="_ _2"> </span>the<span class="_ _2"> </span>error<span class="_ _2"> </span>message<span class="_ _2"> </span><span class="ff5">undefined<span class="_ _4"> </span>reference<span class="_ _4"> </span>to<span class="_ _4"> </span>‘exit’</span>.</div><div class="t m0 xf h9 y790 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _18"> </span>riscv64-unknown-elf-ld<span class="_ _4"> </span>-m<span class="_ _4"> </span>elf32lriscv<span class="_ _4"> </span>main.o<span class="_ _4"> </span>-o<span class="_ _18"> </span>main.x</div><div class="t m0 xf h9 y791 ff5 fs4 fc0 sc0 ls0 ws0">riscv64-unknown-elf-ld:<span class="_ _18"> </span>warning:<span class="_ _4"> </span>cannot<span class="_ _4"> </span>find<span class="_ _4"> </span>entry<span class="_ _4"> </span>symbol<span class="_ _18"> </span>start;<span class="_ _4"> </span>...</div><div class="t m0 xf h9 y792 ff5 fs4 fc0 sc0 ls0 ws0">riscv64-unknown-elf-ld:<span class="_ _18"> </span>main.o:<span class="_ _4"> </span>in<span class="_ _4"> </span>function<span class="_ _4"> </span>‘start’:</div><div class="t m0 xf h9 y793 ff5 fs4 fc0 sc0 ls0 ws0">(.text+0x8):<span class="_ _18"> </span>undefined<span class="_ _4"> </span>reference<span class="_ _4"> </span>to<span class="_ _4"> </span>‘exit’</div><div class="t m0 xf hb y794 ff6 fs6 fc0 sc0 ls0 ws0">3.2.4<span class="_ _11"> </span>Global<span class="_ _7"> </span>vs<span class="_ _7"> </span>lo<span class="_ _5"></span>cal<span class="_ _24"> </span>sym<span class="_ _27"></span>b<span class="_ _5"></span>ols</div><div class="t m0 xf h8 y795 ff3 fs4 fc0 sc0 ls0 ws0">Sym<span class="_ _1"></span>b<span class="_ _5"></span>ols<span class="_ _3"> </span>are<span class="_ _b"> </span>classiﬁed<span class="_ _3"> </span>as<span class="_ _b"> </span>lo<span class="_ _5"></span>cal<span class="_ _3"> </span>or<span class="_ _b"> </span>global<span class="_ _3"> </span>symbols.<span class="_ _1c"> </span>Lo<span class="_ _5"></span>cal<span class="_ _3"> </span>symbols<span class="_ _b"> </span>are<span class="_ _3"> </span>only<span class="_ _b"> </span>visible<span class="_ _3"> </span>on<span class="_ _b"> </span>the<span class="_ _3"> </span>same<span class="_ _b"> </span>ﬁle,<span class="_ _b"> </span><span class="ff8">i.e.</span>,</div><div class="t m0 xf h8 y796 ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _6"> </span>linker do<span class="_ _5"></span>es<span class="_ _6"> </span>not<span class="_ _2"> </span>use<span class="_ _6"> </span>them<span class="_ _6"> </span>to<span class="_ _2"> </span>resolv<span class="_ _1"></span>e<span class="_ _6"> </span>undeﬁned<span class="_ _6"> </span>references<span class="_ _6"> </span>on<span class="_ _2"> </span>other<span class="_ _6"> </span>ﬁles.<span class="_ _7"> </span>Global<span class="_ _6"> </span>symbols,<span class="_ _6"> </span>on<span class="_ _2"> </span>the<span class="_ _6"> </span>other</div><div class="t m0 xf h8 y797 ff3 fs4 fc0 sc0 ls0 ws0">hand,<span class="_ _2"> </span>are<span class="_ _2"> </span>used<span class="_ _6"> </span>by<span class="_ _6"> </span>the<span class="_ _2"> </span>linker<span class="_ _6"> </span>to<span class="_ _2"> </span>resolve<span class="_ _6"> </span>undeﬁned<span class="_ _2"> </span>reference<span class="_ _2"> </span>on<span class="_ _2"> </span>other<span class="_ _2"> </span>ﬁles.</div><div class="t m0 xc h8 y798 ff3 fs4 fc0 sc0 ls0 ws0">By<span class="_ _7"> </span>default,<span class="_ _24"> </span>the<span class="_ _7"> </span>assembler<span class="_ _34"> </span>registers<span class="_ _7"> </span>lab<span class="_ _5"></span>els<span class="_ _7"> </span>as<span class="_ _7"> </span>lo<span class="_ _5"></span>cal<span class="_ _24"> </span>sym<span class="_ _27"></span>b<span class="_ _5"></span>ols.<span class="_ _2c"> </span>The<span class="_ _7"> </span><span class="ff5">.globl<span class="_ _24"> </span></span>directiv<span class="_ _27"></span>e<span class="_ _24"> </span>is<span class="_ _7"> </span>an<span class="_ _7"> </span>assembly</div><div class="t m0 xf h8 y799 ff3 fs4 fc0 sc0 ls0 ws0">directiv<span class="_ _1"></span>e<span class="_ _7"> </span>that<span class="_ _7"> </span>instructs<span class="_ _7"> </span>the<span class="_ _7"> </span>assembler<span class="_ _34"> </span>to<span class="_ _24"> </span>register<span class="_ _7"> </span>a<span class="_ _7"> </span>lab<span class="_ _5"></span>el<span class="_ _7"> </span>as<span class="_ _7"> </span>a<span class="_ _7"> </span>global<span class="_ _24"> </span>sym<span class="_ _27"></span>b<span class="_ _5"></span>ol.<span class="_ _2c"> </span>The<span class="_ _7"> </span>following<span class="_ _7"> </span>example</div><div class="t m0 xf h8 y79a ff3 fs4 fc0 sc0 ls0 ws0">sho<span class="_ _1"></span>ws<span class="_ _3"> </span>an<span class="_ _3"> </span>assembly<span class="_ _2"> </span>program<span class="_ _3"> </span>in<span class="_ _b"> </span>whic<span class="_ _27"></span>h<span class="_ _b"> </span>the<span class="_ _3"> </span><span class="ff5">.globl<span class="_ _3"> </span></span>directive<span class="_ _2"> </span>is<span class="_ _3"> </span>used<span class="_ _3"> </span>to<span class="_ _b"> </span>instruct<span class="_ _3"> </span>the<span class="_ _3"> </span>assembler<span class="_ _2"> </span>to<span class="_ _3"> </span>register</div><div class="t m0 xf h8 y79b ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _2"> </span><span class="ff5">exit<span class="_ _2"> </span></span>lab<span class="_ _5"></span>el<span class="_ _6"> </span>as<span class="_ _2"> </span>a<span class="_ _2"> </span>global<span class="_ _2"> </span>symbol<span class="_ _2"> </span>on<span class="_ _2"> </span>the<span class="_ _2"> </span>symbol<span class="_ _2"> </span>table.</div><div class="t m0 x114 h9 y79c ff22 fs11 fc0 sc0 ls0 ws0">1<span class="_ _2a"> </span><span class="ff5 fs4">#<span class="_ _4"> </span>Contents<span class="_ _18"> </span>of<span class="_ _4"> </span>the<span class="_ _4"> </span>exit.s<span class="_ _4"> </span>file</span></div><div class="t m0 x114 h9 y79d ff22 fs11 fc0 sc0 ls0 ws0">2<span class="_ _2a"> </span><span class="ff5 fs4">.globl<span class="_ _4"> </span>exit</span></div><div class="t m0 x114 h9 y79e ff22 fs11 fc0 sc0 ls0 ws0">3<span class="_ _2a"> </span><span class="ff5 fs4">exit:</span></div><div class="t m0 x114 h9 y79f ff22 fs11 fc0 sc0 ls0 ws0">4<span class="_ _37"> </span><span class="ff5 fs4">li<span class="_ _18"> </span>a0,<span class="_ _4"> </span>0</span></div><div class="t m0 x114 h9 y7a0 ff22 fs11 fc0 sc0 ls0 ws0">5<span class="_ _37"> </span><span class="ff5 fs4">li<span class="_ _18"> </span>a7,<span class="_ _4"> </span>93</span></div><div class="t m0 x114 h9 y7a1 ff22 fs11 fc0 sc0 ls0 ws0">6<span class="_ _37"> </span><span class="ff5 fs4">ecall</span></div><div class="t m0 xc h8 y7a2 ff3 fs4 fc0 sc0 ls0 ws0">Assuming the co<span class="_ _5"></span>de that inv<span class="_ _27"></span>okes the <span class="ff5">exit<span class="_ _89"> </span></span>function is lo<span class="_ _5"></span>cated on the <span class="ff5">main.s<span class="_ _38"> </span></span>ﬁle and the <span class="ff5">exit<span class="_ _38"> </span></span>function</div><div class="t m0 xf h8 y7a3 ff3 fs4 fc0 sc0 ls0 ws0">is<span class="_ _6"> </span>lo<span class="_ _5"></span>cated<span class="_ _2"> </span>on<span class="_ _6"> </span>the<span class="_ _2"> </span><span class="ff5">exit.s<span class="_ _2"> </span></span>ﬁle,<span class="_ _6"> </span>the<span class="_ _2"> </span>following<span class="_ _6"> </span>sequence<span class="_ _6"> </span>of<span class="_ _2"> </span>commands<span class="_ _2"> </span>sho<span class="_ _1"></span>ws<span class="_ _6"> </span>how<span class="_ _6"> </span>to<span class="_ _6"> </span>ass<span class="_ _5"></span>em<span class="_ _27"></span>ble<span class="_ _2"> </span>b<span class="_ _5"></span>oth<span class="_ _2"> </span>ﬁles<span class="_ _6"> </span>and</div><div class="t m0 xf h8 y7a4 ff3 fs4 fc0 sc0 ls0 ws0">link<span class="_ _2"> </span>them<span class="_ _2"> </span>together.</div><div class="t m0 xf h9 y5b6 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _18"> </span>riscv64-unknown-elf-as<span class="_ _4"> </span>-march=rv32im<span class="_ _4"> </span>main.s<span class="_ _4"> </span>-o<span class="_ _4"> </span>main.o</div><div class="t m0 xf h9 y109 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _18"> </span>riscv64-unknown-elf-as<span class="_ _4"> </span>-march=rv32im<span class="_ _4"> </span>exit.s<span class="_ _4"> </span>-o<span class="_ _4"> </span>exit.o</div><div class="t m0 xf h9 ye0 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _18"> </span>riscv64-unknown-elf-ld<span class="_ _4"> </span>-m<span class="_ _4"> </span>elf32lriscv<span class="_ _4"> </span>main.o<span class="_ _4"> </span>exit.o<span class="_ _18"> </span>-o<span class="_ _4"> </span>main.x</div><div class="t m0 xf h9 ye1 ff5 fs4 fc0 sc0 ls0 ws0">riscv64-unknown-elf-ld:<span class="_ _18"> </span>warning:<span class="_ _4"> </span>cannot<span class="_ _4"> </span>find<span class="_ _4"> </span>entry<span class="_ _4"> </span>symbol<span class="_ _18"> </span>start;<span class="_ _4"> </span>...</div><div class="t m0 x2c h8 y33 ff3 fs4 fc0 sc0 ls0 ws0">Prin<span class="_ _1"></span>ted<span class="_ _2"> </span>v<span class="_ _1"></span>ersion<span class="_ _2"> </span>a<span class="_ _1"></span>v<span class="_ _27"></span>ailable<span class="_ _2"> </span>for<span class="_ _6"> </span>purchase<span class="_ _6"> </span>at<span class="_ _2"> </span>Amazon.com</div><div class="t m0 x2d h8 y141 ff3 fs4 fc0 sc0 ls0 ws0">F<span class="_ _9"></span>ree<span class="_ _2"> </span>online<span class="_ _6"> </span>version<span class="_ _6"> </span>at<span class="_ _2"> </span><span class="ff5">http://riscv-<span class="_ _22"></span>programming.org</span></div><div class="t m0 x2e h8 y142 ff3 fs4 fc0 sc0 ls0 ws0">(Generated<span class="_ _2"> </span>on<span class="_ _2"> </span>Octob<span class="_ _5"></span>er<span class="_ _6"> </span>15,<span class="_ _2"> </span>2023)</div><div class="t m0 xb8 h8 y33 ff3 fs4 fc0 sc0 ls0 ws0">32</div><a class="l" href="https://a.co/d/gUfKWsD"><div class="d m1" style="border-style:none;position:absolute;left:358.258000px;bottom:69.067000px;width:58.171000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:271.722000px;bottom:56.835000px;width:148.940000px;height:11.125000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
